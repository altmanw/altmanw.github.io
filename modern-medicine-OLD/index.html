<!doctype html><html itemscope lang=en-us itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=theme-name content="hugoplate"><link rel="shortcut icon" href=/images/favicon_hu8746059088890723258.png type=image/x-icon><link rel=icon href=/images/favicon_hu8746059088890723258.png type=image/x-icon><link rel=icon type=image/png sizes=48x48 href=/images/favicon_hu11713732441643767409.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon_hu8746059088890723258.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon_hu13781583406303279869.png><link rel=manifest href=/manifest.webmanifest><meta name=msapplication-TileColor content="#ddd"><meta name=theme-color content="#ffffff"><base href=https://willaltman.tech/modern-medicine-OLD/><title>MODERN MEDICINE</title>
<meta name=keywords content="Altman,GameDev,Developer"><meta name=description content="MODERN MEDICINE"><meta name=author content="Will Altman"><meta property="og:title" content="MODERN MEDICINE"><meta property="og:description" content="MODERN MEDICINE"><meta property="og:type" content="website"><meta property="og:url" content="https://willaltman.tech/modern-medicine-OLD/"><meta name=twitter:title content="MODERN MEDICINE"><meta name=twitter:description content="MODERN MEDICINE"><meta name=twitter:site content="@PrizmROBLOX"><meta name=twitter:creator content="@Will Altman"><script>let indexURL="https://willaltman.tech/searchindex.json",includeSectionsInSearch=["blog"],search_no_results="No results for",search_initial_message="Type something to search.."</script><meta http-equiv=x-dns-prefetch-control content="on"><link rel=preconnect href=https://use.fontawesome.com crossorigin><link rel=preconnect href=//cdnjs.cloudflare.com><link rel=preconnect href=//www.googletagmanager.com><link rel=preconnect href=//www.google-analytics.com><link rel=dns-prefetch href=https://use.fontawesome.com><link rel=dns-prefetch href=//ajax.googleapis.com><link rel=dns-prefetch href=//cdnjs.cloudflare.com><link rel=dns-prefetch href=//www.googletagmanager.com><link rel=dns-prefetch href=//www.google-analytics.com><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//connect.facebook.net><link rel=dns-prefetch href=//platform.linkedin.com><link rel=dns-prefetch href=//platform.twitter.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600&family=Signika:wght@500;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><link href="/css/style.min.deb1109dbad644e37eab5cd348cedfc91b12e870793cea9a036f32d57ccaf152.css" integrity="sha256-3rEQnbrWRON+q1zTSM7fyRsS6HB5POqaA28y1XzK8VI=" rel=stylesheet><link defer async rel=stylesheet href="/css/style-lazy.min.1891ab9d1988b9b19756de1bbea47aecb95c7b5ab195f6fe52244b6eca5d8154.css" integrity="sha256-GJGrnRmIubGXVt4bvqR67Llce1qxlfb+UiRLbspdgVQ=" media=print onload='this.media="all",this.onload=null'></head><body><header class="header sticky top-0 z-30"><nav class="navbar container"><div class=order-0><a class="navbar-brand block" href=/><img fetchpriority=high decoding=async class="img img-light" width=160 height=32 src=/images/name-icon_hu14768301767699835405.webp alt="Will Altman" onerror='this.onerror=null,this.src="/images/name-icon_hu14170043961657880537.png"'>
<img fetchpriority=high decoding=async class="img img-dark" width=160 height=32 src=/images/name-icon_hu14768301767699835405.webp alt="Will Altman" onerror='this.onerror=null,this.src="/images/name-icon_hu14170043961657880537.png"'></a></div><input id=nav-toggle type=checkbox class=hidden>
<label for=nav-toggle class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1"><svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg><svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8 nav-menu-adjust"><li class=nav-item><a class=nav-link href=/>Home</a></li><li class=nav-item><a class=nav-link href=/resume.pdf>Résumé</a></li><li class=nav-item><a class=nav-link target=_blank rel=noopener href=https://github.com/altmanw/lua-code-sample>Code Sample (lua)</a></li><li class="nav-item nav-dropdown group relative"><span class="nav-link
inline-flex items-center">Projects<svg class="h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg></span><ul class="nav-dropdown-list lg:group-hover:visible lg:group-hover:opacity-100"><li class=nav-dropdown-item><a class=nav-dropdown-link href=/modern-medicine>MODERN MEDICINE</a></li><li class=nav-dropdown-item><a class=nav-dropdown-link href=/final-bounty>Final Bounty</a></li><li class=nav-dropdown-item><a class=nav-dropdown-link href=/webgl>WebGL Engine</a></li></ul></li><li class=nav-item><a class=nav-link href=/></a></li></ul><div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0"><div class="theme-switcher mr-5 hidden"><input id=theme-switcher data-theme-switcher type=checkbox>
<label for=theme-switcher><span class=sr-only>theme switcher</span>
<span><svg class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 opacity-100 dark:opacity-0" viewBox="0 0 56 56" fill="#fff" height="16" width="16"><path d="M30 4.6c0-1-.9-2-2-2a2 2 0 00-2 2v5c0 1 .9 2 2 2s2-1 2-2zm9.6 9a2 2 0 000 2.8c.8.8 2 .8 2.9.0L46 13a2 2 0 000-2.9 2 2 0 00-3 0zm-26 2.8c.7.8 2 .8 2.8.0.8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9.0-.7.8-.7 2.1.0 3zM28 16A12 12 0 0016 28a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0028 16zm23.3 14c1.1.0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 00-2 2c0 1.1 1 2 2 2zM4.7 26a2 2 0 00-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2zm37.8 13.6a2 2 0 00-3 0 2 2 0 000 2.9l3.6 3.5a2 2 0 002.9.0c.8-.8.8-2.1.0-3zM10 43.1a2 2 0 000 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1.0-2.9s-2-.8-2.9.0zm20 3.4c0-1.1-.9-2-2-2a2 2 0 00-2 2v4.9c0 1 .9 2 2 2s2-1 2-2z"/></svg><svg class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 opacity-0 dark:opacity-100" viewBox="0 0 24 24" fill="none" height="16" width="16"><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4.0 008.7 1.8c1-.3 2 .5 1.5 1.5v.1A10.3 10.3.0 0112.4 22 10.3 10.3.0 013.2 6.7c1-2 2.9-3.5 4.9-4.4z"/></svg></span></label></div><script>var darkMode=!0;localStorage.getItem("theme")==="dark"?darkMode=!0:localStorage.getItem("theme")==="light"&&(darkMode=!1),darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),document.addEventListener("DOMContentLoaded",()=>{var e=document.querySelectorAll("[data-theme-switcher]"),t=document.querySelector(".theme-switcher");[].forEach.call(e,function(e){e.checked=darkMode,e.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light")})}),t.classList.remove("hidden")})</script></div></nav></header><main><section><div class="container text-center"><div class="from-body to-theme-light dark:from-darkmode-body dark:to-darkmode-theme-light rounded-2xl bg-gradient-to-b px-8 py-14"><h1>MODERN MEDICINE</h1></div></div></section><section class=section-sm><div class=container><div class="row justify-center"><div class=lg:col-10><div class=content><img title="image title" loading=lazy decoding=async class="img img-fluid img-center" width=500 height=500 src=/images/mm/pics/modern-medicine-icon-500x500_hu15799274415710924403.png alt="MODERN MEDICINE logo" onerror='this.onerror="null",this.src="/images/mm/pics/modern-medicine-icon-500x500_hu15799274415710924403.png"'>
<script>window.addEventListener("load",e=>{const t=GLightbox()})</script><img title="image title" loading=lazy decoding=async class="img img-fluid img-center" width=800 height=203 src=/images/mm/pics/prizm-logo-darkmode_hu2311216746607895772.png alt="PRIZM GAMES logo" onerror='this.onerror="null",this.src="/images/mm/pics/prizm-logo-darkmode_hu2311216746607895772.png"'><br><br><div style=text-align:center><p><p><strong>MODERN MEDICINE</strong> is a procedurally generated cross platform multiplayer horror adventure with a branching storyline that was released on Roblox in 2024. It has reached over <strong>980,000 play sessions</strong> and over <strong>400,000 unique players</strong>.</p><p>As the sole programmer and founder of the development team, I was responsible for designing and implementing all technical systems including procedural generation, AI and player systems, in-game purchase systems, backend infrastructure, and seamless multiplayer functionality just to name a few. My research skills also played a key role in this process, as I discovered and used key open source libraries that streamlined development and workflows. In collaboration with the team&rsquo;s level designer and artist, I helped shape a game that offers players a uniquely immersive and replayable experience.</p><p>During the two-year development cycle, I led our remote team of three through weekly meetings to align on goals, refine designs, and ensure steady progress. This flagship project honed my expertise in Luau, the Roblox API, and efficient team management while showcasing my ability to deliver a polished, innovative game through fostering a friendly, creative, and collaborative environment.</p></div><hr><h3 id=trailer>Trailer</h3><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/fHYzytSEc9Y?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><hr><section id=Features><h3 id=at-a-glance>At a Glance:</h3><ul><li><a href=../modern-medicine#Gameplay-loop>Gameplay Loop</a></li><li><a href=../modern-medicine#AI>AI</a></li><li><a href=../modern-medicine#Procedural-Generation>Procedural Generation</a></li><li><a href=../modern-medicine#Player-Systems>Player Systems</a></li><li><a href=../modern-medicine#Infrastructure-Tooling>Infrastructure and Tooling</a></li><li><a href=../modern-medicine#Backend>Backend</a></li></ul></section><hr><section id=Gameplay-loop><h3 id=gameplay-loop>Gameplay Loop</h3><p>MODERN MEDICINE takes place in an abandoned hospital overrun by Dr. Thompson&rsquo;s failed experiments. The game begins with an active medical emergency in the ICU, where players must stabilize a patient under pressure. However, the power suddenly shuts off, forcing players to make a critical choice: restore power in the Maintenance room to allow the nurses to continue giving life saving care or retrieve key research notes from Dr. Thompson&rsquo;s office.</p><p>From there, players navigate through procedurally generated hallways, searching for essential items needed at their destination while avoiding the wandering monsters. Upon collecting the items and reaching their destination, players are faced with a unique puzzle that they must solve before they can achieve their mission. Upon completion, players are given another choice for their next mission and face an intense chase sequence in the hallways to get there.</p><p>Once the puzzle in the second cycle is completed, the hallways and world regenerate seamlessly in the background. Upon leaving the room the player finds themselves in the experimentation wing, where they must tackle escalating challenges while navigating through the hospital&rsquo;s dark secrets. The game culminates in a terrifying sequence where the player must sprint through the hallways to the Experimentation laboratory, pursued by hordes of almost every monster encountered throughout the game.</p><p><a href=../modern-medicine#Features>Back to top</a></p></section><hr><section id=AI><h3 id=ai>AI</h3><p>There are many unique AI agents in MODERN MEDICINE. The below section is a summary of what they are and what they do. The section after that describes core systems and gives implementation examples.</p><h4 id=monsters>MONSTERS</h4><h6 id=larry>LARRY</h6><p>Larry is the flagship monster - an experiment on the hospital&rsquo;s janitor gone wrong. He intercepts players in the halls every time the lobby completes a major milestone of the quest line, and if a player gets too close they are dealt an extreme amount of damage. To add to the challenge, each additional time he spawns he is given increased speed. He utilizes the player region module to locate his target and the A* module combined with the level node graph to pathfind to his target.</p><p>Larry&rsquo;s design consists of several key points:</p><ul><li>Each step Larry takes sends the booming sound of his weight reverberating through the hallways. This is the first warning sign to the player that he is near.</li><li>The closer Larry is to the player, the more his footsteps shake the player&rsquo;s screen.</li><li>Larry emits a terrifying noise which gets louder as he nears a player.</li><li>With each footstep, Larry spawns a ring of fire around his body, adding to the spectacle while also denoting his attack range to the player.</li></ul><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/larry.gif does not exist</strong><h6 id=johnny>JOHNNY</h6><p>Johnny is a radiation monster spawned from additional inhumane experiments conducted in the hospital. He resides in the medicine floor, randomly navigating from one end of the hallways to another. When the player is close, Johnny emits a geiger counter noise as well as immense screen shake. As he flys through the halls he opens doors to the patient rooms on either side of him, making the experience of players hiding in these rooms that much more immersive.</p><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/johnny.gif does not exist</strong><p>Because the layout of the medicine floor is generated using prefabricated assets and he does not chase players, there is no need to use A* pathing for his navigation. Instead, a series of nodes are placed in each sub-layout that define a path from an out-of-bounds part of the hallway to the main, unchanging &ldquo;L&rdquo; hallway. For each monster cycle, a random out of bounds start point is chosen, the monster follows that point&rsquo;s path to the main hallway, then it randomly chooses another path to an out of bounds region.</p><figure class=img-center role=group aria-describedby="caption-The navigational nodes are highlighted in blue. The monster will start out of bounds, navigate to the central hallway, then navigate out of bounds again."><a href=/images/mm/pics/medfloor-pathing.png class=glightbox data-glightbox="description: .caption-The-navigational-nodes-are-highlighted-in-blue-The-monster-will-start-out-of-bounds-navigate-to-the-central-hallway-then-navigate-out-of-bounds-again-"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=850 height=500 src=/images/mm/pics/medfloor-pathing_hu6699879497486981256.png alt="A layout for the medfloor." onerror='this.onerror="null",this.src="/images/mm/pics/medfloor-pathing_hu6699879497486981256.png"'></a><figcaption id="caption-The navigational nodes are highlighted in blue. The monster will start out of bounds, navigate to the central hallway, then navigate out of bounds again." class=caption-The-navigational-nodes-are-highlighted-in-blue-The-monster-will-start-out-of-bounds-navigate-to-the-central-hallway-then-navigate-out-of-bounds-again->The navigational nodes are highlighted in blue. The monster will start out of bounds, navigate to the central hallway, then navigate out of bounds again.</figcaption></figure><h6 id=dr-thompson>DR. THOMPSON</h6><p>Dr. Thompson is the main villain of the hospital. The player only encounters his projected forms in the Operating Room, where he is seen standing frozen over the player&rsquo;s character immobilized on an operating table. If the player looks at him for too long, his head will suddenly animate and stare at the player. As soon as line of sight is broken between the player and Dr. T., the player is transported onto the operating table for a POV experience of the doctor operating on them.</p><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/dr-t.gif does not exist</strong><p>For best responsiveness, Dr. Thompson&rsquo;s vision system is client sided. There are 3 checks that must pass for a player to be attacked by the monster:</p><ol><li>The player must be within the proper distance</li><li>The monster must exist within the player&rsquo;s viewport</li><li>A raycast from the monster&rsquo;s head must hit the player. Note: collision groups are used to allow for raycasts through transparent objects in this scenario.</li></ol><p>If every check passes, then the player is looking at Dr. Thompson. After a short but random amount of time, Dr. Thompson will activate, staring down the player. Once line of sight is broken, he attacks.</p><h6 id=roaches>ROACHES</h6><p>Roaches wander the hallways. When hungry, roaches will fly onto the player&rsquo;s face and will attack until they are swatted away.</p><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/roach.gif does not exist</strong><h6 id=wandering-faces>WANDERING FACES</h6><p>Wandering Faces are monsters that slowly float along the hallways. Whether they try to navigate to a player or wander randomly is left to chance. When the player looks at a wandering face, they start to get a tunnel vision effect. If the stare for too long, the wandering face will draw the player into it, dealing damage.</p><p>To make the hallways feel dense and to save on resources, there are only ever a small number of wandering faces in the world at any given time. Once a face is far enough away from all players, it respawns in a location closer to the action.</p><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/wandering-face.gif does not exist</strong><h6 id=hunter>HUNTER</h6><p>The hunter is a monster that was added to solve a critical issue we came across while playtesting: players in random lobbies don&rsquo;t stick together. We developed the core quest system under the assumption that as soon as one player finds the room they need to go to, all the players would be able to easily and quickly join them. This held true for private playtests with friends and family, but as soon as we tested with random people who didn&rsquo;t know each we quickly discovered this would not always be the case. Thus the hunter was created to deal with stragglers and keep the game progressing smoothly.</p><p>Hunters spawning in is signified by every direction panel illuminating simultaneously. Each player is hunted by a unique hunter which is only visible to them (but still controlled by the server). The hunter will follow and observe the player at a distance. After the player has remained in its line of sight for long enough, its body will turn neon orange - signifying that it is preparing to attack. When it does attack, it deals a moderate amount of damage and teleports the player to the destination room for the current quest. The player can delay the hunter&rsquo;s attack by breaking line of sight or hopping into various rooms along the way. If they player stays in a room for too long, however, a warning effect will play and after some time the hunter will still attack.</p><figure class=img-center role=group aria-describedby="caption-Hunters are harmless while observing."><a href=/images/mm/pics/hunter-white.png class=glightbox data-glightbox="description: .caption-Hunters-are-harmless-while-observing"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=850 height=475 src=/images/mm/pics/hunter-white_hu10356484114920470068.png alt="A monster with neon white eyes and antlers" onerror='this.onerror="null",this.src="/images/mm/pics/hunter-white_hu10356484114920470068.png"'></a><figcaption id="caption-Hunters are harmless while observing." class=caption-Hunters-are-harmless-while-observing>Hunters are harmless while observing.</figcaption></figure><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/hunter-1.gif does not exist</strong>
<strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/hunter-room-attack.gif does not exist</strong><h6 id=unseen-ones-angels>UNSEEN ONES (ANGELS)</h6><p>Unseen Ones are the final monster encountered in the game and my personal favorite. They are heavily inspired by the Weeping Angels from Dr. Who. During the game&rsquo;s finale, the hallways completely regenerate and feature only one biome: the experimentation wing. This is where the unseen ones are found. These monsters silently stalk the player and move incredibly quickly when out of sight. However, when the player has any of the monsters within their line of sight, they feeze mid animation and appear as a statue.</p><p>On their own they are not that challenging to get past if you are aware of them, but the true difficulty comes closer to the end of the game. As the player progresses through the experimentation challenges, more and more monsters spawn in the hallways, including the Wandering Faces. This creates a unique synergy because the Wandering Faces will attack if you look at them for too long, and the Unseen Ones will attack if you look away. So when the hallways have both, it creates a stressful and fun challenge.</p><strong style=color:red;margin-bottom:15px;display:inline-block>https://willaltman.tech//images/mm/gifs/weeping-angel.gif does not exist</strong><p>Unseen Ones&rsquo; movement logic works by checking two primary things:</p><ol><li>Is there a valid raycast between the player and the monster</li><li>Is the player looking at the monster</li></ol><p>To simplify communication, these movement checks are performed on the server. Checking the raycast simply checks if there are any objects between the player and the monster. Other agents do not count as valid objects for this raycast and are filtered out. Checking if the player is looking at the monster takes the vector between the agent and the player, then performs the dot product to get the angle between that vector and the player&rsquo;s look vector</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> dVec <span style=color:#f92672>=</span> agentHead.Position <span style=color:#f92672>-</span> viewerHead.Position
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--Positive means the angle between the two vectors is less than abs(90). 0 is a right angle, negative is not visible</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> inFov <span style=color:#f92672>=</span> dVec:Dot(viewerHead.CFrame.LookVector) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> 
</span></span></code></pre></div><h4 id=systems>SYSTEMS</h4><p>AI agents all share several core systems. Monsters that navigate the hallways reuse the A* module found in other parts of the code. Other monsters that spawn inside rooms utilize a more simplistic node based navigation system. All 3D monsters utilize the same animation module, which allows both the client and the server to control an agent&rsquo;s animations.</p><p>For more complicated agents, behavior trees are necessary to map out their logic. I utilize the <a href=https://devforum.roblox.com/t/btreesv5-rojo-support-fixes/1781449 target=_blank>BTreesV5</a> plugin to streamline my implementation.</p><figure class=img-center role=group aria-describedby="caption-The hunter&rsquo;s behavior tree."><a href=/images/mm/pics/hunter-btree-1.png class=glightbox data-glightbox="description: .caption-The-hunters-behavior-tree"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=812 height=600 src=/images/mm/pics/hunter-btree-1_hu4648819717763840133.png alt="A graph representing a behavior tree." onerror='this.onerror="null",this.src="/images/mm/pics/hunter-btree-1_hu4648819717763840133.png"'></a><figcaption id="caption-The hunter&rsquo;s behavior tree." class=caption-The-hunters-behavior-tree>The hunter&rsquo;s behavior tree.</figcaption></figure><p><a href=../modern-medicine#Features>Back to top</a></p></section><hr><section id=Procedural-Generation><h3 id=procedural-generation>Procedural Generation</h3><p>MODERN MEDICINE is a game that was partially inspired by LSPLASH&rsquo;s Doors on Roblox. Doors procedurally generates its world by linking prefabricated rooms together linearly - the (single) exit of any given room is connected to the (single) entrance of the next. MODERN MEDICINE expands and innovates on this idea. Instead of each room in the world being generated one after another, rooms are linked to each other by a series of randomly sprawling hallways.</p><h6 id=1-representing-the-world>1. Representing the world</h6><p>One thing that hasn&rsquo;t changed much since its initial prototype is how the world is abstractly represented in code. The level is stored in an n x m array of nodes, with each node containing information about what exists in that location (e.g. is this a room, hallway, doorway, what biome is this, etc&mldr;). Nodes also store a reference to their neighbors, creating a graph. Being able to look up nodes in both an array or explore nodes as a graph provides important flexibility in how the game interacts with the world since many corners of the code base use this core system.</p><figure class=img-center role=group aria-describedby="caption-A debug visualization of the node graph"><a href=/images/mm/pics/level-console-debug.png class=glightbox data-glightbox="description: .caption-A-debug-visualization-of-the-node-graph"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=500 height=493 src=/images/mm/pics/level-console-debug_hu9073148654774452497.png alt="Console debug world visualization" onerror='this.onerror="null",this.src="/images/mm/pics/level-console-debug_hu9073148654774452497.png"'></a><figcaption id="caption-A debug visualization of the node graph" class=caption-A-debug-visualization-of-the-node-graph>A debug visualization of the node graph</figcaption></figure><h6 id=2-the-hallways-must-be-interesting-to-walk-through>2. The hallways must be interesting to walk through</h6><p>The first prototype for hallway generation was simple: place the rooms randomly on a grid, then use A* to connect each doorway node to every other doorway node, prioritizing previously placed hallways. Then, randomly select several hallway nodes and expand them to create unique biomes.</p><figure class=img-center role=group aria-describedby="caption-An early prototype example of procedural world generation"><a href=/images/mm/pics/procedural-gen-proto.png class=glightbox data-glightbox="description: .caption-An-early-prototype-example-of-procedural-world-generation"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=500 height=398 src=/images/mm/pics/procedural-gen-proto_hu8978034997542039531.png alt="A series of rooms connected by straight hallways" onerror='this.onerror="null",this.src="/images/mm/pics/procedural-gen-proto_hu8978034997542039531.png"'></a><figcaption id="caption-An early prototype example of procedural world generation" class=caption-An-early-prototype-example-of-procedural-world-generation>An early prototype example of procedural world generation</figcaption></figure><p>While this prototype did achieve our goal procedural generation goals, it had one major issue revealed by early playtests: walking for minutes on end through a straight hallway isn&rsquo;t fun. So it was back to the drawing board. The level generation system had to be snakey and interesting while also not being overly frustrating or confusing to navigate like a maze would be.</p><p>The first solution was to utilize node weights in the A* algorithm for more than just prioritizing previously generated hallways. What if every node had a random weight value? This was better, but the sheer randomness was obvious when playing. The hallways had to seem at least somewhat realistic and a straight maze was not an option I wanted to entertain. Stumped, I looked towards other games that used procedural generation for inspiration and eventually looked towards Minecraft. Minecraft utilizes perlin noise to create &ldquo;natural&rdquo; looking curves and features in its terrain generation. What if I generated the node weights for the hallways using perlin noise? I had just implemented a technique I would later learn is called Perlin Worm Tunneling.</p><figure class=img-center role=group aria-describedby="caption-An early example of procedural world generation utilizing perlin worm tunneling"><a href=/images/mm/pics/perlin-example.png class=glightbox data-glightbox="description: .caption-An-early-example-of-procedural-world-generation-utilizing-perlin-worm-tunneling"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=685 height=500 src=/images/mm/pics/perlin-example_hu11671213877469198173.png alt="A series of rooms connected by bendy hallways" onerror='this.onerror="null",this.src="/images/mm/pics/perlin-example_hu11671213877469198173.png"'></a><figcaption id="caption-An early example of procedural world generation utilizing perlin worm tunneling" class=caption-An-early-example-of-procedural-world-generation-utilizing-perlin-worm-tunneling>An early example of procedural world generation utilizing perlin worm tunneling</figcaption></figure><h6 id=3-biomes>3. Biomes</h6><p>My next goal was to implement a more interesting biome system with the goal of having fewer, larger biomes. To do this, I simply recycled the idea of using perlin noise. Once the initial map and hallways are generated, I create a new perlin noise map for the nodes. Then, I select a node at random to be an anchor point for a random biome. I generate another set of values, each +/- n from the anchor point&rsquo;s noise value. Then, manifest destiny style, I add the surrounding nodes to this anchor point&rsquo;s biome grouping provided that the surrounding nodes have not been added to a different biome already and are within the +/- n range generated earlier. This process is repeated DFS style with all of the captured nodes until there are no more neighbors within the range. Then, a different random (unclaimed) node is chosen to be a new anchor and the process repeats. This continues until a predetermined percentage of all the nodes are captured, with the remaining nodes being classified as the default biome.</p><figure class=img-center role=group aria-describedby="caption-The different colors above the hallways represent certain biome types"><a href=/images/mm/pics/biome-example.png class=glightbox data-glightbox="description: .caption-The-different-colors-above-the-hallways-represent-certain-biome-types"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=577 height=500 src=/images/mm/pics/biome-example_hu7070551091969716453.png alt="A series of rooms connected by bendy hallways, each with specific biomes" onerror='this.onerror="null",this.src="/images/mm/pics/biome-example_hu7070551091969716453.png"'></a><figcaption id="caption-The different colors above the hallways represent certain biome types" class=caption-The-different-colors-above-the-hallways-represent-certain-biome-types>The different colors above the hallways represent certain biome types</figcaption></figure><p>To add additional flair to the hallways, &ldquo;straightaway&rdquo; portions are detected and generate with unique designs.</p><figure class=img-center role=group aria-describedby="caption-Straightaways are denoted by the cyan color. Each biome has unique straightaway designs."><a href=/images/mm/pics/straightaway.png class=glightbox data-glightbox="description: .caption-Straightaways-are-denoted-by-the-cyan-color-Each-biome-has-unique-straightaway-designs"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=662 height=500 src=/images/mm/pics/straightaway_hu4332081565582284750.png alt="A series of rooms connected by bendy hallways with straightaways visualized" onerror='this.onerror="null",this.src="/images/mm/pics/straightaway_hu4332081565582284750.png"'></a><figcaption id="caption-Straightaways are denoted by the cyan color. Each biome has unique straightaway designs." class=caption-Straightaways-are-denoted-by-the-cyan-color-Each-biome-has-unique-straightaway-designs>Straightaways are denoted by the cyan color. Each biome has unique straightaway designs.</figcaption></figure><figure class=img-center role=group aria-describedby="caption-Straightaway portions of hallways have unique, repeatable designs that span multiple nodes"><a href=/images/mm/pics/straightaway-experimentation.png class=glightbox data-glightbox="description: .caption-Straightaway-portions-of-hallways-have-unique-repeatable-designs-that-span-multiple-nodes"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=799 height=500 src=/images/mm/pics/straightaway-experimentation_hu4022964574383898664.png alt="A green hallway with unique designs on the walls" onerror='this.onerror="null",this.src="/images/mm/pics/straightaway-experimentation_hu4022964574383898664.png"'></a><figcaption id="caption-Straightaway portions of hallways have unique, repeatable designs that span multiple nodes" class=caption-Straightaway-portions-of-hallways-have-unique-repeatable-designs-that-span-multiple-nodes>Straightaway portions of hallways have unique, repeatable designs that span multiple nodes</figcaption></figure><p>Some biomes may have unique features that require their assets to be larger than the size of one node. In the medfloor biome, the ceiling is curved like a train tunnel. For tight angles, additional assets beyond the bounds of a single node are needed. All walls are generated with these additional assets, and those which exist outside of a hallway node are deleted at runtime to prevent clipping issues.</p><figure class=img-center role=group aria-describedby="caption-Arches beyond the bounds of a single node will be removed at runtime if they do not exist within a hallway node with the medfloor biome."><a href=/images/mm/pics/corner-arch.png class=glightbox data-glightbox="description: .caption-Arches-beyond-the-bounds-of-a-single-node-will-be-removed-at-runtime-if-they-do-not-exist-within-a-hallway-node-with-the-medfloor-biome"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=787 height=500 src=/images/mm/pics/corner-arch_hu9483995667494361880.png alt="A wall with a curving arch" onerror='this.onerror="null",this.src="/images/mm/pics/corner-arch_hu9483995667494361880.png"'></a><figcaption id="caption-Arches beyond the bounds of a single node will be removed at runtime if they do not exist within a hallway node with the medfloor biome." class=caption-Arches-beyond-the-bounds-of-a-single-node-will-be-removed-at-runtime-if-they-do-not-exist-within-a-hallway-node-with-the-medfloor-biome>Arches beyond the bounds of a single node will be removed at runtime if they do not exist within a hallway node with the medfloor biome.</figcaption></figure><figure class=img-center role=group aria-describedby="caption-The arches must extend beyond the size of a single node to be flush with other arches."><a href=/images/mm/pics/medfloor.png class=glightbox data-glightbox="description: .caption-The-arches-must-extend-beyond-the-size-of-a-single-node-to-be-flush-with-other-arches"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=687 height=494 src=/images/mm/pics/medfloor_hu8474804930144497015.png alt="A mysterious hallway with curved ceilings and vines hanging off the walls." onerror='this.onerror="null",this.src="/images/mm/pics/medfloor_hu8474804930144497015.png"'></a><figcaption id="caption-The arches must extend beyond the size of a single node to be flush with other arches." class=caption-The-arches-must-extend-beyond-the-size-of-a-single-node-to-be-flush-with-other-arches>The arches must extend beyond the size of a single node to be flush with other arches.</figcaption></figure><h6 id=4-rooms>4. Rooms</h6><p>At runtime, several core rooms are selected to be placed into the world randomly, then several &ldquo;shortcut&rdquo; and &ldquo;loot&rdquo; rooms are randomly selected and placed around the world. Most rooms in the game feature at least some degree of procedural generation. Take the medfloor for example. This room has the player duck into rooms in order to dodge a wandering radiation monster. To make this interesting throughout multiple playthroughs, the layout of the room changes.</p><p>The core layout of the room consists of an L shape. On several sides of the L shape, one of 4 different layouts can generate. Within these layouts, random room designs generate. Notice the long L hallway is the same in all of the below pictures, but the surrounding designs change.</p><div class="gallery
zoomable"><div class=gallery-item><a href=/images/mm/pics/medfloor-layouts/medfloor-A.png style=display:block class=glightbox><img loading=lazy src=/images/mm/pics/medfloor-layouts/medfloor-A_hu1533039328844543245.png class=img style=margin:0 alt=medfloor-A.png onerror='this.onerror="null",this.src="/images/mm/pics/medfloor-layouts/medfloor-A_hu1533039328844543245.png"'></a></div><div class=gallery-item><a href=/images/mm/pics/medfloor-layouts/medfloor-B.png style=display:block class=glightbox><img loading=lazy src=/images/mm/pics/medfloor-layouts/medfloor-B_hu813179119119010370.png class=img style=margin:0 alt=medfloor-B.png onerror='this.onerror="null",this.src="/images/mm/pics/medfloor-layouts/medfloor-B_hu813179119119010370.png"'></a></div><div class=gallery-item><a href=/images/mm/pics/medfloor-layouts/medfloor-C.png style=display:block class=glightbox><img loading=lazy src=/images/mm/pics/medfloor-layouts/medfloor-C_hu9850677197337668609.png class=img style=margin:0 alt=medfloor-C.png onerror='this.onerror="null",this.src="/images/mm/pics/medfloor-layouts/medfloor-C_hu9850677197337668609.png"'></a></div></div><h6 id=4-navigation>4. Navigation</h6><p>Later playtests leading up to the launch of the game revealed another issue: being lost in the hallways is frustrating. The player needed some sort of indication if they were getting closer to their target room. This prompted the development of direction panels placed randomly throughout the world. When activated, an arrow illuminates on the panel pointing towards the correct direction, and a line temporarily appears on the floor to aid with navigation.</p><figure class=img-center role=group aria-describedby="caption-Direction panels can be activated to assist with navigation."><a href=/images/mm/gifs/direction-panel.gif class=glightbox data-glightbox="description: .caption-Direction-panels-can-be-activated-to-assist-with-navigation"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/direction-panel.gif alt="A panel on the wall being activated to show an arrow pointing the direction to go." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-Direction panels can be activated to assist with navigation." class=caption-Direction-panels-can-be-activated-to-assist-with-navigation>Direction panels can be activated to assist with navigation.</figcaption></figure><p>There is more to displaying the correct arrow on the panel than it may seem. Direction panels have a chance of generating on any of the existing walls of a hallway node (north, east, south, west). First, the node the panel exists in is mathematically calculated, then the node object is retrieved for use based off its coordinates. To find the correct direction, the A* system used in world generation is recycled to pathfind from the panel&rsquo;s node to one of the destination room&rsquo;s doorways. This path is then sent to the client to display the on-floor line. On the server the direction of the path is calculated by finding both the unit vector between the source node&rsquo;s midpoint and the first node in the path&rsquo;s midpoint (for direction), as well as the unit vector between the source node&rsquo;s midpoint and the direction panel (the arrow will &ldquo;face&rdquo; a different direction depending on what wall it is on). Using these two vectors, the correct facing arrow can be selected and displayed as needed.</p><p><a href=../modern-medicine#Features>Back to top</a></p></section><hr><section id=Player-Systems><h3 id=gui--player-systems>GUI & PLAYER SYSTEMS</h3><h5 id=clipboard>CLIPBOARD</h5><p>The player&rsquo;s HUD went through many iterations throughout the course of the game. For most of development, objectives were permanently displayed in corner of the screen and other information was available through a gui shaped like a clipboard. This combined with dialogue, hotbar, and other visual elements made the screen feel very cluttered. To fix this and increase immersion, I moved many of these gui elements onto a physical clipboard that the player can equip at any time. The result is a clean feeling user interface, with the only permanent element being the player&rsquo;s hotbar and some occasional elements appearing for dialogue and new objectives.</p><figure class=img-center role=group aria-describedby="caption-HUD elements displayed on the player&rsquo;s clipboard."><a href=/images/mm/pics/clipboard.png class=glightbox data-glightbox="description: .caption-HUD-elements-displayed-on-the-players-clipboard"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=576 height=500 src=/images/mm/pics/clipboard_hu6601461883157673066.png alt="A clipboard" onerror='this.onerror="null",this.src="/images/mm/pics/clipboard_hu6601461883157673066.png"'></a><figcaption id="caption-HUD elements displayed on the player&rsquo;s clipboard." class=caption-HUD-elements-displayed-on-the-players-clipboard>HUD elements displayed on the player&rsquo;s clipboard.</figcaption></figure><figure class=img-center role=group aria-describedby="caption-When interacted with, lore documents display on the player&rsquo;s clipboard. Equipping the clipboard again will return to the normal gui."><a href=/images/mm/pics/clipboard-lore.png class=glightbox data-glightbox="description: .caption-When-interacted-with-lore-documents-display-on-the-players-clipboard-Equipping-the-clipboard-again-will-return-to-the-normal-gui"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=577 height=500 src=/images/mm/pics/clipboard-lore_hu13313434164584854596.png alt="A clipboard" onerror='this.onerror="null",this.src="/images/mm/pics/clipboard-lore_hu13313434164584854596.png"'></a><figcaption id="caption-When interacted with, lore documents display on the player&rsquo;s clipboard. Equipping the clipboard again will return to the normal gui." class=caption-When-interacted-with-lore-documents-display-on-the-players-clipboard-Equipping-the-clipboard-again-will-return-to-the-normal-gui>When interacted with, lore documents display on the player&rsquo;s clipboard. Equipping the clipboard again will return to the normal gui.</figcaption></figure><h5 id=toolbar-stamina-and-health>TOOLBAR, STAMINA, AND HEALTH</h5><p>The toolbar, stamina indicator, and health bar are the gui elements which were not relocated to clipboard.</p><ul><li>The toolbar displays all active items the player has, along with their count or fuel level. It has full cross platform support, and adds additional gui icons for controller navigation when needed.</li><li>The stamina indicator bar slides off the screen while the player is sprinting. If the player has full health, the bar disappears. For added tension, it slides off the screen using an exponential function - the stamina appears to degrade &ldquo;slower&rdquo; the closer the player is to running out.</li><li>The health bar displays the percentage of health the player has remaining. If the player has full health, the bar disappears. The player may purchase permanent health upgrades in the shop to increase their max health. The health bar reflects this.</li></ul><figure class=img-center role=group aria-describedby="caption-The player sprinting, healing, and using the toolbar."><a href=/images/mm/gifs/sprinting.gif class=glightbox data-glightbox="description: .caption-The-player-sprinting-healing-and-using-the-toolbar"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/sprinting.gif alt="The player ruuning through hallways, using items." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-The player sprinting, healing, and using the toolbar." class=caption-The-player-sprinting-healing-and-using-the-toolbar>The player sprinting, healing, and using the toolbar.</figcaption></figure><h5 id=lobby>LOBBY</h5><p>The lobby has 3 core gui systems: the shop, achievements, and settings.</p><p>The shop gui displays all of the in-game purchases the player can make using both Robux (Roblox currency) and RVUs (Custom currency). The player can exchange Robux for RVUs in the shop, or earn RVUs by playing the game. The shop also displays examples of skins the player can purchase in viewport frames.</p><figure class=img-center role=group aria-describedby="caption-Navigating through the lobby shop. Player currency is displayed&mldr;"><a href=/images/mm/gifs/lobby-shop-gui.gif class=glightbox data-glightbox="description: .caption-Navigating-through-the-lobby-shop-Player-currency-is-displayed"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/lobby-shop-gui.gif alt="A gui shop." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-Navigating through the lobby shop. Player currency is displayed&mldr;" class=caption-Navigating-through-the-lobby-shop-Player-currency-is-displayed>Navigating through the lobby shop. Player currency is displayed&mldr;</figcaption></figure><p>The achievements gui displays every badge that is available in the game and whether the player has unlocked each specific badge or not. Discovered lore docs are also viewable from this gui. They are sorted by rarity, and the player can click on a document to access it again.</p><figure class=img-center role=group aria-describedby="caption-The achievement gui displays all badges and discovered lore documents"><a href=/images/mm/gifs/achievement-gui.gif class=glightbox data-glightbox="description: .caption-The-achievement-gui-displays-all-badges-and-discovered-lore-documents"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/achievement-gui.gif alt="A gui menu." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-The achievement gui displays all badges and discovered lore documents" class=caption-The-achievement-gui-displays-all-badges-and-discovered-lore-documents>The achievement gui displays all badges and discovered lore documents</figcaption></figure><p>The settings gui allows the player to customize their experience. They can enable or disable certain features, choose special chat tags to display by their name, and choose monster skins. If multiple skins for the same monster are selected, one will be chosen at random during the game when the monster spawns in. Monster skins are shared between all players in a current session, meaning if one player has the Crimson Larry skin enabled, all other players will be able to see it.</p><figure class=img-center role=group aria-describedby="caption-The settings gui allows players to customize their experience."><a href=/images/mm/gifs/settings-gui.gif class=glightbox data-glightbox="description: .caption-The-settings-gui-allows-players-to-customize-their-experience"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/settings-gui.gif alt="A gui menu." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-The settings gui allows players to customize their experience." class=caption-The-settings-gui-allows-players-to-customize-their-experience>The settings gui allows players to customize their experience.</figcaption></figure><h5 id=cross-platform-support>CROSS PLATFORM SUPPORT</h5><p>All gui elements were designed with cross platform support in mind. All gui buttons have their neighbors mapped to assist with controller navigation. When a controller is detected, button images will appear to help with navigation. The gui elements also work on touchscreen devices, as well as in VR.</p><figure class=img-center role=group aria-describedby="caption-Navigating the lobby guis using a controller"><a href=/images/mm/gifs/controller-shop-nav.gif class=glightbox data-glightbox="description: .caption-Navigating-the-lobby-guis-using-a-controller"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/controller-shop-nav.gif alt="A gui menu with controller support." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-Navigating the lobby guis using a controller" class=caption-Navigating-the-lobby-guis-using-a-controller>Navigating the lobby guis using a controller</figcaption></figure><p><a href=../modern-medicine#Features>Back to top</a></p></section><hr><section id=Infrastructure-Tooling><h3 id=infrastructure>Infrastructure</h3><h5 id=open-source-libraries>Open Source Libraries</h5><p>Several open source libraries and plugins helped make MODERN MEDICINE possible:</p><ul><li><a href=https://sleitnick.github.io/Knit/docs/intro/ target=_blank>Knit</a></li><li><a href=https://rojo.space/ target=_blank>Rojo</a></li><li><a href=https://sleitnick.github.io/RbxUtil/ target=_blank>RbxUtil</a></li><li><a href=https://madstudioroblox.github.io/ProfileService/ target=_blank>ProfileService</a></li></ul><p>One of the first challenges I encountered while developing MODERN MEDICINE was deciding how to organize the code. After researching possible frameworks, I decided on using <a href=https://sleitnick.github.io/Knit/docs/intro/ target=_blank>Knit</a> in order to simplify communication across the client-server boundary and to take advantage of its built in structure with services and controllers. I also use <a href=https://rojo.space/ target=_blank>Rojo</a> as part of my workflow in order to program in VSCode instead of the Roblox editor and to make version control with github easier.</p><p>I also took advantage of the <a href=https://sleitnick.github.io/RbxUtil/ target=_blank>RbxUtil</a> library to further streamline development and prevent myself from reinventing the wheel. Out of the entire library, I found myslef using <a href=https://sleitnick.github.io/RbxUtil/api/Component/ target=_blank>Components</a> to streamline and organize tagged objects as well as <a href=https://sleitnick.github.io/RbxUtil/api/Trove/ target=_blank>Troves</a> to clean any connections or other items after they are no longer needed. The RbxUtil libraary also provides the <a href=https://sleitnick.github.io/RbxUtil/api/Signal/ target=_blank>Signal</a> data structure, which is a core part of Knit, to simplify handling RemoteEvents and RemoteFunctions.</p><p><a href=https://madstudioroblox.github.io/ProfileService/ target=_blank>ProfileService</a> is also used for the backend (see the backend section).</p><img title="image title" loading=lazy decoding=async src=https://devforum-uploads.s3.dualstack.us-east-2.amazonaws.com/uploads/optimized/5X/5/d/5/a/5d5a916bf96005152c48b86a1ba947b76468ccb2_2_690x345.png alt="The Knit logo" class="img img-fluid img-center
glightbox" width=800 height=300><h5 id=regions>Regions</h5><p>The region system is a core part of the code base. It continuously calculates each player&rsquo;s position within the node graph. If the player moves into a new node, an event is fired. It also keeps track of various statistics regarding each region, such as the number of players currently in the region. Some of the areas the system is used includes:</p><ul><li>Determining if client-side monster effects can play (e.g. Larry&rsquo;s footsteps causing screen shake only in the hallways)</li><li>Determining player position in the hallways for use in monster chase logic</li><li>Communicating the player&rsquo;s level location to the client (i.e. which hallway biome or room is the player in)</li><li>Dialogue cues when a player enters a room</li><li>Locking players into a room when they enter it</li><li>Determining which sounds a player can hear</li></ul><h5 id=advanced-linear-interpolation>Advanced Linear Interpolation</h5><p>The Roblox API provides an excellent base of tools, especially for lerping objects using their Tween library. However, this library is not without its limitations. Throughout the game, players will loot objects for various quests or to collect/purchase items while moving. With the Roblox Tween library, it is not possible to interpolate an object to a moving target. This means if a player picks up an object while running, the object will move to where the player was at the time the object was picked up, not where the player is when the interpolation finishes. To do this, I wrote a custom module accounts for the movement of the player after an object is picked up. This module also contains networking code which allows every player to perform this interpolation locally on the client, rather than on the server. This makes the interpolation appear smooth because it runs at the client&rsquo;s frame rate rather than the reduced tick rate of the server.</p><figure class=img-center role=group aria-describedby="caption-The oxygen tank is pulled towards the player that collected it as the player strafes to the side."><a href=/images/mm/gifs/looting-item.gif class=glightbox data-glightbox="description: .caption-The-oxygen-tank-is-pulled-towards-the-player-that-collected-it-as-the-player-strafes-to-the-side"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=500 src=/images/mm/gifs/looting-item.gif alt="A player collecting an oxygen container." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-The oxygen tank is pulled towards the player that collected it as the player strafes to the side." class=caption-The-oxygen-tank-is-pulled-towards-the-player-that-collected-it-as-the-player-strafes-to-the-side>The oxygen tank is pulled towards the player that collected it as the player strafes to the side.</figcaption></figure><p>There are various other linear interpolation modules implemented into the game that would not be possible using the Tween library.</p><ul><li>Using distance instead of time to calculate the transparency of biome walls as Larry approaches them, preventing the monster from appearing to phase through the wall.</li><li>Using distance to determine the frequency at which the biome doors themselves pulse (or if they should not pulse) when Larry approaches</li></ul><h5 id=other-miscellaneous-tooling>Other Miscellaneous Tooling</h5><h6 id=level-building>Level Building</h6><p>The core system used when populating the level with assets is the Ghost system. This system went through several interations in order to balance the technical complexity and ability with ease of use for the level designer. For a brief description, a ghost is a primitive object tagged as such that has a path attribute. The path attribute links to a folder which contains any number of potential assets to spawn at the ghost object&rsquo;s location. For ease of development there is no strict format enforcement of the file structure. Folders can be nested anywhere, and when a floder is linked only model objects will be considered for spawning (allowing folders and models to exist within the same directory).</p><figure class=img-center role=group aria-describedby="caption-A clone of the ghost object is placed on the asset which is being spawned by the level designer to ensure proper positioning."><a href=/images/mm/pics/ghost-example.png class=glightbox data-glightbox="description: .caption-A-clone-of-the-ghost-object-is-placed-on-the-asset-which-is-being-spawned-by-the-level-designer-to-ensure-proper-positioning"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=370 src=/images/mm/pics/ghost-example_hu16383589565647025649.png alt="A gui menu with controller support." onerror='this.onerror="null",this.src="/images/mm/pics/ghost-example_hu16383589565647025649.png"'></a><figcaption id="caption-A clone of the ghost object is placed on the asset which is being spawned by the level designer to ensure proper positioning." class=caption-A-clone-of-the-ghost-object-is-placed-on-the-asset-which-is-being-spawned-by-the-level-designer-to-ensure-proper-positioning>A clone of the ghost object is placed on the asset which is being spawned by the level designer to ensure proper positioning.</figcaption></figure><p>This system allows for individual asset spawning probability to be customized and more complicated &ldquo;ghost structures&rdquo; to be formed, such as generating the hallways or forming loot groups within the world. Ghosts can also be nested inside assets spawned by ghosts, allowing for extreme customization and differences between levels.</p><p>Individual rooms can also randomly select certain themes to randomly choose elements from while using the same ghost layout. For example, the level designer can create one office layout but have different groups of ghosts that represent different theming. This way, if the office is randomly chosen to be safari themed, the randomly selected assets will only be from the safari bucket.</p><h6 id=room-construction>Room Construction</h6><p>Rooms don&rsquo;t have to be square. They can be any shape the level designer can imagine. However, to simplify room placement in the node graph, rooms are requiered to be built on a square surface whose width and height are divisible by the default node size (so it can be divided into nodes). To prevent a bunch of dead space in the node graph, the level designer can place &ldquo;air tiles&rdquo; on unused portions of the room&rsquo;s square surface. This signals to the node graph at runtime that these nodes are unoccupied and may be populated with other specialty nodes such as hallways.</p><p>The level designer can also place multiple &ldquo;door tiles&rdquo; on the build. These tiles do not necessarily need to be on the perimiter of the square surface as long as there is a way for a hallway to reach it (using air tiles). These door tiles will spawn a door to the room and guarantee that a hallway spawns on the node bordering it.</p><figure class=img-center role=group aria-describedby="caption-In this prototype room, air tiles are red, the door tile is blue, and the transparent objects are ghosts."><a href=/images/mm/pics/air-tiles.png class=glightbox data-glightbox="description: .caption-In-this-prototype-room-air-tiles-are-red-the-door-tile-is-blue-and-the-transparent-objects-are-ghosts"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=549 height=500 src=/images/mm/pics/air-tiles_hu5452826000981262830.png alt="A top down view of a room with air tiles, door tiles, and ghosts" onerror='this.onerror="null",this.src="/images/mm/pics/air-tiles_hu5452826000981262830.png"'></a><figcaption id="caption-In this prototype room, air tiles are red, the door tile is blue, and the transparent objects are ghosts." class=caption-In-this-prototype-room-air-tiles-are-red-the-door-tile-is-blue-and-the-transparent-objects-are-ghosts>In this prototype room, air tiles are red, the door tile is blue, and the transparent objects are ghosts.</figcaption></figure><h6 id=hallway-construction>Hallway Construction</h6><p>Hallways are constructed by populating a ghost node with assets from the relevant biome. All hallways need walls, doorways, biome doorways (double doors), ceilings, and floors. Additionaly, they may have ceiling props, wall props, and straightaways. Each category can have multiple possible assets to spawn and each asset can optionally have its own unique spawning probability. At runtime, the node graph is used to calculate which sides of the node walls, doorways, etc. need to spawn in.</p><figure class=img-center role=group aria-describedby="caption-A doorway for the experimentation biome. This is used to connect the hallways to various the various rooms."><a href=/images/mm/pics/experimentation-doorway.png class=glightbox data-glightbox="description: .caption-A-doorway-for-the-experimentation-biome-This-is-used-to-connect-the-hallways-to-various-the-various-rooms"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=424 height=374 src=/images/mm/pics/experimentation-doorway_hu12004261840264815860.png alt="A single wall with a unique design that features a doorway" onerror='this.onerror="null",this.src="/images/mm/pics/experimentation-doorway_hu12004261840264815860.png"'></a><figcaption id="caption-A doorway for the experimentation biome. This is used to connect the hallways to various the various rooms." class=caption-A-doorway-for-the-experimentation-biome-This-is-used-to-connect-the-hallways-to-various-the-various-rooms>A doorway for the experimentation biome. This is used to connect the hallways to various the various rooms.</figcaption></figure><figure class=img-center role=group aria-describedby="caption-A straightaway section for the deafult biome which spawns on the ceiling. Straightaways are at least 3 nodes long and have a starting point, variable number of middle points, and an ending point."><a href=/images/mm/pics/pipe-straightaway.png class=glightbox data-glightbox="description: .caption-A-straightaway-section-for-the-deafult-biome-which-spawns-on-the-ceiling-Straightaways-are-at-least-3-nodes-long-and-have-a-starting-point-variable-number-of-middle-points-and-an-ending-point"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=253 src=/images/mm/pics/pipe-straightaway_hu9125710781085647281.png alt="A top down view of a room with air tiles, door tiles, and ghosts" onerror='this.onerror="null",this.src="/images/mm/pics/pipe-straightaway_hu9125710781085647281.png"'></a><figcaption id="caption-A straightaway section for the deafult biome which spawns on the ceiling. Straightaways are at least 3 nodes long and have a starting point, variable number of middle points, and an ending point." class=caption-A-straightaway-section-for-the-deafult-biome-which-spawns-on-the-ceiling-Straightaways-are-at-least-3-nodes-long-and-have-a-starting-point-variable-number-of-middle-points-and-an-ending-point>A straightaway section for the deafult biome which spawns on the ceiling. Straightaways are at least 3 nodes long and have a starting point, variable number of middle points, and an ending point.</figcaption></figure><h6 id=generic-doors>Generic Doors</h6><p>There are a lot of rooms in MODERN MEDICINE. Beacuse doors require some scripting overhead, I created this system for the level designer to be able to easily and quickly create new door designs and sizes without any programming overhead. These generic door objects will open when a player stands close to them, and close when they have left the vicinity. All the level designer has to do to create a new door is group assets together and name the &ldquo;door part&rdquo; of the door as &ldquo;Door&rdquo;. At runtime, the program will calculate the door hinge and hitboxes and begin listening for player interaction.</p><figure class=img-center role=group aria-describedby="caption-Generic door hitboxes are visualized in this image. They are the same width and height as the original door and are offset and widened. The door will open in a different direction depending on which side the player was detected."><a href=/images/mm/pics/generic-door.png class=glightbox data-glightbox="description: .caption-Generic-door-hitboxes-are-visualized-in-this-image-They-are-the-same-width-and-height-as-the-original-door-and-are-offset-and-widened-The-door-will-open-in-a-different-direction-depending-on-which-side-the-player-was-detected"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=335 height=262 src=/images/mm/pics/generic-door_hu4339728049434428212.png alt="A player standing in a doorway." onerror='this.onerror="null",this.src="/images/mm/pics/generic-door_hu4339728049434428212.png"'></a><figcaption id="caption-Generic door hitboxes are visualized in this image. They are the same width and height as the original door and are offset and widened. The door will open in a different direction depending on which side the player was detected." class=caption-Generic-door-hitboxes-are-visualized-in-this-image-They-are-the-same-width-and-height-as-the-original-door-and-are-offset-and-widened-The-door-will-open-in-a-different-direction-depending-on-which-side-the-player-was-detected>Generic door hitboxes are visualized in this image. They are the same width and height as the original door and are offset and widened. The door will open in a different direction depending on which side the player was detected.</figcaption></figure><h6 id=sliding-doors>Sliding Doors</h6><p>Similar to generic doors, sliding doors are also streamlined for the level designer. They contain a &ldquo;Door&rdquo; object which is the primary object in the door, as well as two distinct sets of parts: &ldquo;MovingParts&rdquo; and &ldquo;StaticParts&rdquo;. At runtime, the door is primed and a prompt is proximity prompt is placed into it. When the prompt is activated, the sliding door slides its body length to the right in order to open.</p><figure class=img-center role=group aria-describedby="caption-Instead of using hitboxes, sliding doors are triggered manually."><a href=/images/mm/pics/sliding-door.png class=glightbox data-glightbox="description: .caption-Instead-of-using-hitboxes-sliding-doors-are-triggered-manually"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=535 height=300 src=/images/mm/pics/sliding-door_hu13740605075738682442.png alt="A player standing next to a sliding ICU door." onerror='this.onerror="null",this.src="/images/mm/pics/sliding-door_hu13740605075738682442.png"'></a><figcaption id="caption-Instead of using hitboxes, sliding doors are triggered manually." class=caption-Instead-of-using-hitboxes-sliding-doors-are-triggered-manually>Instead of using hitboxes, sliding doors are triggered manually.</figcaption></figure><h6 id=sound-effect-parts>Sound Effect Parts</h6><p>Quality atmospheric sound design was one of my key ambitions for this project. To assist with this goal, I created sound effect parts and their supporting infrastructure. Sound effect parts are components which will play a specific sound, and also contain metadata about how the sound should play. Some of this metadata include:</p><ul><li>Sound Location (i.e. can be thound be heard in the hallways or just a specific room)</li><li>Playback range</li><li>Sound table information (are we pulling a random sound out of a group? e.g. one of several thunder sounds) or sound name</li><li>Playback information (should we loop the sound, should we randomly select a sound from a sound table and loop it, should we play every sound in a sound table back to back, etc&mldr;)</li></ul><p>To minimize the amount of objects that needed to be transferred between world files during development, all sound data is serialized in a master sound file.</p><h6 id=light-flickering>Light Flickering</h6><p>Light flickering is implemented similarly to how it was in Quake (and still implemented in modern games like Half Life: Alyx). Light patterns are stored as a string of characters ranging from a-z. When enabled, the program reads one character individually and adjusts the light&rsquo;s brightness to the brightness represented by that character. Then after a small delay, it does the same with the next character. When it runs out of characters, it starts over at the beginning. An additional modification I made to this idea is adding upper case characters to the character strings that represent certain sounds, e.g. a &ldquo;light popping&rdquo; sound.</p><figure class=img-center role=group aria-describedby="caption-Lights flickering in the hallway."><a href=/images/mm/gifs/light-flicker.gif class=glightbox data-glightbox="description: .caption-Lights-flickering-in-the-hallway"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=800 height=300 src=/images/mm/gifs/light-flicker.gif alt="Lights flickering in the medicine floor hallways." onerror='this.onerror="null",this.src=""'></a><figcaption id="caption-Lights flickering in the hallway." class=caption-Lights-flickering-in-the-hallway>Lights flickering in the hallway.</figcaption></figure><p><a href=../modern-medicine#Features>Back to top</a></p></section><hr><section id=Backend><h3 id=backend>Backend</h3><p>The core of the backend system uses <a href=https://madstudioroblox.github.io/ProfileService/ target=_blank>ProfileService</a> which is an extension module for DataStores. ProfileService is a is a profile object abstraction seperated from the Player instance which streamlines datastore implementation and handles lots of edge cases such as providing protection against item duplication exploits.</p><h5 id=monetization-and-transaction-workflows>Monetization and Transaction Workflows</h5><p>There are two types of transactions the player can make: Robux transactions and RVU transactions. RVUs (Relative Value Units) are the in-game premium currency.</p><h6 id=developer-products>Developer Products</h6><ol><li>The client uses a remote event to request developer product purchase</li><li>The server recieves event and fires <code>MarketplaceService:PromptProductPurchase</code> with the player and product id</li><li>The player purchases the product using the Roblox GUI</li><li>If the transaction is successful, the <code>MarketplaceService.ProcessReceipt</code> callback is triggered<ul><li>If verification fails, <code>Enum.ProductPurchaseDecision.NotProcessedYet</code> is returned</li></ul></li><li>The server retrieves and verifies player&rsquo;s data profile from ProfileService<ul><li>If there is an error verifying the player profile, <code>Enum.ProductPurchaseDecision.NotProcessedYet</code> is returned</li></ul></li><li>The player&rsquo;s data profile&rsquo;s metadata is reviewed and written to ensuring the developer product is not being granted multiple times for the same transaction<ul><li>If an error or abnormality is detected, <code>Enum.ProductPurchaseDecision.NotProcessedYet</code> is returned.</li></ul></li><li>The product id is processed and the product is added to the player&rsquo;s account</li><li>A remote event is fired informing the client that the purchase was a success</li><li><code>Enum.ProductPurchaseDecision.PurchaseGranted</code> is returned</li></ol><p>Notes:</p><ul><li>If <code>Enum.ProductPurchaseDecision.NotProcessedYet</code> is fired, <code>MarketplaceService</code> will perform the transaction again if the user makes another purchase or rejoins the server.</li></ul><figure class=img-center role=group aria-describedby="caption-The RVU boost is a developer product which increases the amount of RVUs the player can earn in a run."><a href=/images/mm/pics/rvu-boost.png class=glightbox data-glightbox="description: .caption-The-RVU-boost-is-a-developer-product-which-increases-the-amount-of-RVUs-the-player-can-earn-in-a-run"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=372 height=350 src=/images/mm/pics/rvu-boost_hu13508906636964823812.png alt="A player standing in a doorway." onerror='this.onerror="null",this.src="/images/mm/pics/rvu-boost_hu13508906636964823812.png"'></a><figcaption id="caption-The RVU boost is a developer product which increases the amount of RVUs the player can earn in a run." class=caption-The-RVU-boost-is-a-developer-product-which-increases-the-amount-of-RVUs-the-player-can-earn-in-a-run>The RVU boost is a developer product which increases the amount of RVUs the player can earn in a run.</figcaption></figure><h6 id=custom-currency-rvu-products>Custom Currency (RVU) Products</h6><p>A similar workflow is used for RVU purchases, but it does not go through the <code>MarketplaceService</code> due to the currency being proprietary. If a player does not have enough RVU to complete the transaction, they are prompted to purchase more.</p><figure class=img-center role=group aria-describedby="caption-The RVU curency icon."><a href=/images/rvu-icon.png class=glightbox data-glightbox="description: .caption-The-RVU-curency-icon"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=351 height=350 src=/images/rvu-icon_hu16080892942391585793.png alt="A shield with a crystalized color patter design and a medical logo on it." onerror='this.onerror="null",this.src="/images/rvu-icon_hu16080892942391585793.png"'></a><figcaption id="caption-The RVU curency icon." class=caption-The-RVU-curency-icon>The RVU curency icon.</figcaption></figure><h6 id=gamepasses>Gamepasses</h6><p>Gamepass purchases rely almost entirely on the Roblox backend, which prevents players from purchasing the same gamepass multiple times. When joining the game, players are sent to a lobby. When they are ready to play the game, players hop in an elevator which moves them to a private server and sets up the match. Gamepasses only purchasesable in the lobby or on the Roblox website and only affect the match servers, therefore there is no need to detect gamepass purchases in real time.</p><p><code>MarketplaceService.PromptGamePassPurchaseFinished</code> could detect real time purchases in game servers, but the player&rsquo;s gamepasses would still need to be detected when the player loads into the server to account for purchases on the website. So to avoid redundancy, <code>MarketplaceService.PromptGamePassPurchaseFinished</code> is not used and any new gamepasses are detected when players first load into a server and are recorded on the player data profile. These gamepasses are then applied accordingly.</p><h5 id=player-statistics>Player Statistics</h5><p>By using ProfileService, tracking specific player stats is streamlined. The module allows for the tracking of any player-specific statistic that seems interesting, such as deaths to specific monsters, games played, currency collected, etc. Statistic tracking runs through the custom PlayerDataService module, and any corner of the code base that wishes to record data runs through it.</p><h5 id=global-statistics>Global Statistics</h5><p>Global statistics rely solely on Roblox&rsquo;s DataStoreService rather than running through PlayerService. For leaderboard tracking, ordered data stores are used and are shared throughout all servers. These sort user ids in descending order based on the statistic being tracked. When read from, only the top page in the data store is retrieved. For data stores that don&rsquo;t need sorting (such as name in the game), only user ids are stored.</p><p>There are several globally tracked items:</p><ul><li>Name in the Game Gamepass Purchases<ul><li>When purchased, the player&rsquo;s avatar will begin to spawn in hospital beds around the level. This occurs in all games, not just games the specific player is in making it possible for anyone who loads into the game to see the player&rsquo;s avatar.</li></ul></li><li>Lifetime RVU<ul><li>This includes RVU earned by playing matches as well as RVU purchased</li></ul></li><li>Lifetime Wins<ul><li>Recorded when a player beats the game</li></ul></li><li>Lifetime Games<ul><li>This is recorded every time a player starts a match</li></ul></li></ul><figure class=img-center role=group aria-describedby="caption-A picture of the coins leaderboard which is located in the lobby."><a href=/images/mm/pics/coins-leaderboard.png class=glightbox data-glightbox="description: .caption-A-picture-of-the-coins-leaderboard-which-is-located-in-the-lobby"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=673 height=350 src=/images/mm/pics/coins-leaderboard_hu13027392019720045632.png alt="A leaderboard showing the top 20 players with the most coins collected." onerror='this.onerror="null",this.src="/images/mm/pics/coins-leaderboard_hu13027392019720045632.png"'></a><figcaption id="caption-A picture of the coins leaderboard which is located in the lobby." class=caption-A-picture-of-the-coins-leaderboard-which-is-located-in-the-lobby>A picture of the coins leaderboard which is located in the lobby.</figcaption></figure><h5 id=analytics>Analytics</h5><p>MODERN MEDICINE&rsquo;s post launch development relies heavily on use of Roblox&rsquo;s <code>AnalyticsService</code> to determine player retention and drop off rates through funnels and other analyitics. Throughout the game state logic there are dozens of analytics hooks tracking player progression, monster damage, shop purchases (not with premium currency). Using the data accumulated from thousands of playthroughs on the live servers we are able to pinpoint weak aspects of our game and target them for improvement. Using analytics we were able to improve the tutorial conversion rate to over 87% only a few weeks after launch.</p><figure class=img-center role=group aria-describedby="caption-Tutorial funnel analytics for September 2024."><a href=/images/mm/pics/tutorial-funnel-3.png class=glightbox data-glightbox="description: .caption-Tutorial-funnel-analytics-for-September-2024"><img title="image title" loading=lazy decoding=async class="img img-fluid" width=1055 height=500 src=/images/mm/pics/tutorial-funnel-3_hu1636640645537202273.png alt="A leaderboard showing the top 20 players with the most coins collected." onerror='this.onerror="null",this.src="/images/mm/pics/tutorial-funnel-3_hu1636640645537202273.png"'></a><figcaption id="caption-Tutorial funnel analytics for September 2024." class=caption-Tutorial-funnel-analytics-for-September-2024>Tutorial funnel analytics for September 2024.</figcaption></figure><p><a href=../modern-medicine#Features>Back to top</a></p></section><hr></div></div></div></div></section></main><footer class="bg-theme-light dark:bg-darkmode-theme-light"><div class=container><div class="row items-center py-10"><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:text-left"><a class="navbar-brand inline-block" href=/><img fetchpriority=high decoding=async class="img img-light" width=160 height=32 src=/images/name-icon_hu14768301767699835405.webp alt="Will Altman" onerror='this.onerror=null,this.src="/images/name-icon_hu14170043961657880537.png"'>
<img fetchpriority=high decoding=async class="img img-dark" width=160 height=32 src=/images/name-icon_hu14768301767699835405.webp alt="Will Altman" onerror='this.onerror=null,this.src="/images/name-icon_hu14170043961657880537.png"'></a></div><div class="lg:col-6 mb-8 text-center lg:mb-0"><ul></ul></div><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:mt-0 lg:text-right"><ul class=social-icons><li><a target=_blank aria-label=roblox rel="nofollow noopener" href=https://www.roblox.com/users/9095598/profile><i class="fas fa-gamepad"></i></a></li><li><a target=_blank aria-label=linkedin rel="nofollow noopener" href=https://www.linkedin.com/in/will-altman-1982561b3><i class="fab fa-linkedin"></i></a></li></ul></div></div></div><div class="border-border dark:border-darkmode-border border-t py-7"><div class="text-light dark:text-darkmode-light container text-center"><p>© 2025 Will Altman</p></div></div></footer><script crossorigin=anonymous integrity="sha256-LO9JECYLqyMcpGlrtxZcpUn0I8AvhO6oIIibJZv4zbk=" src=/js/script.min.2cef4910260bab231ca4696bb7165ca549f423c02f84eea820889b259bf8cdb9.js></script><script defer async crossorigin=anonymous integrity="sha256-w+aS42D2+B+Jix+joZ7pAua1vbu/pRK/IhoP55b8n3w=" src=/js/script-lazy.min.c3e692e360f6f81f898b1fa3a19ee902e6b5bdbbbfa512bf221a0fe796fc9f7c.js></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></body></html>